# üîç –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ ITA_RENT_BOT

## –ü—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### 1. –î—É–±–ª–∏–∫–∞—Ç—ã URL –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–°–∏–º–ø—Ç–æ–º—ã:**

```
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "listings_url_key"
```

**–†–µ—à–µ–Ω–∏–µ:**

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è constraint:

```bash
alembic upgrade head
```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ constraint —É–¥–∞–ª–µ–Ω:

```bash
python debug_system_status.py
```

### 2. –ú–∞–ª–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–∫—Ä–∞–ø–µ—Ä–æ–≤
python test_single_scraper.py idealista
python test_single_scraper.py immobiliare
python test_single_scraper.py subito

# –ò–ª–∏ –≤—Å–µ —Å—Ä–∞–∑—É
python test_single_scraper.py all
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ë–î:**

```bash
python debug_system_status.py
```

### 3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

```bash
# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
python debug_system_status.py

# –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç–¥–µ–ª—å–Ω–æ
python run_notification_worker.py
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**

1. –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏–≤—è–∑–∞–Ω Telegram (`telegram_chat_id`)
2. –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
3. –ï—Å—Ç—å –ª–∏ –Ω–æ–≤—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø–æ–¥ —Ñ–∏–ª—å—Ç—Ä—ã
4. –ù–∞—Å—Ç—Ä–æ–µ–Ω –ª–∏ `TELEGRAM_BOT_TOKEN`

### 4. –°–∫—Ä–∞–ø–µ—Ä—ã –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**

1. –ù–∞—Å—Ç—Ä–æ–µ–Ω –ª–∏ `SCRAPERAPI_KEY`
2. –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
3. –ù–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ IP –∞–¥—Ä–µ—Å–∞

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã

### `debug_system_status.py`

–ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:

- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```bash
python debug_system_status.py
```

### `test_single_scraper.py`

–¢–µ—Å—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–∫—Ä–∞–ø–µ—Ä–æ–≤:

```bash
# –¢–µ—Å—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–∫—Ä–∞–ø–µ—Ä–∞
python test_single_scraper.py idealista
python test_single_scraper.py immobiliare
python test_single_scraper.py subito

# –¢–µ—Å—Ç –≤—Å–µ—Ö —Å–∫—Ä–∞–ø–µ—Ä–æ–≤
python test_single_scraper.py all
```

### `run_notification_worker.py`

–ó–∞–ø—É—Å–∫ worker —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π:

```bash
python run_notification_worker.py
```

## –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏

–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:

```bash
export DEBUG_NOTIFICATIONS=true
```

–í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ:

- –û—Ç–∫–ª—é—á–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –†–∞–∑—Ä–µ—à–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –í–∫–ª—é—á–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## –õ–æ–≥–∏

–í–∞–∂–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

### –°–∫—Ä–∞–ø–∏–Ω–≥

```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º: {'idealista': 15, 'subito': 8, 'immobiliare': 3}
üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: 12 –Ω–æ–≤—ã—Ö, 8 –æ–±–Ω–æ–≤–ª–µ–Ω–æ, 6 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, 2 –æ—à–∏–±–∫–∏
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```
üîî –î–∏—Å–ø–µ—Ç—á–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω: 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, 5 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, 0 –æ—à–∏–±–æ–∫
üìä –ö –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º: {'subito': 3, 'idealista': 2}
```

## –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### 1. `SCRAPERAPI_KEY –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω`

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```
SCRAPERAPI_KEY=your_key_here
```

### 2. `TELEGRAM_BOT_TOKEN –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω`

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```
TELEGRAM_BOT_TOKEN=your_bot_token_here
```

### 3. `UniqueViolation –Ω–∞ URL`

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
alembic upgrade head
```

### 4. –ù–µ—Ç –Ω–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

- –§–∏–ª—å—Ç—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å–ª–∏—à–∫–æ–º –∂–µ—Å—Ç–∫–∏–µ?)
- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ï—Å—Ç—å –ª–∏ –≤–æ–æ–±—â–µ –Ω–æ–≤—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –ë–î

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ production

### Railway –ª–æ–≥–∏

```bash
railway logs
```

### –ú–µ—Ç—Ä–∏–∫–∏

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
- –ß–∞—Å—Ç–æ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –û—à–∏–±–∫–∏ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞

### –ê–ª–µ—Ä—Ç—ã

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞:

- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π > 2 —á–∞—Å–æ–≤
- –û—à–∏–±–∫–∏ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞ > 50%
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π > 24 —á–∞—Å–∞
