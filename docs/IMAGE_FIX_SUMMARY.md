# üñºÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –ø–∞—Ä—Å–µ—Ä–æ–≤

## üìã –†–µ–∑—é–º–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –¥–≤—É—Ö –ø–∞—Ä—Å–µ—Ä–∞—Ö: **Subito.it** –∏ **Casa.it**. 
- ‚úÖ Subito: 32/33 –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (97%)
- ‚úÖ Casa.it: 20/20 –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (100%)

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞ 1: Subito.it - 404 Not Found

### –°–∏–º–ø—Ç–æ–º—ã
- –ë—Ä–∞—É–∑–µ—Ä –≤—ã–±—Ä–∞—Å—ã–≤–∞–ª –æ—à–∏–±–∫—É: `404 (Not Found)`
- URL: `https://images.sbito.it/api/v1/sbt-ads-images-pro/images/4b/4ba7166f-52ff-46a7-9ee3-e2a3071cc916?rule=width-300`

### –ö–æ—Ä–Ω–µ–≤–∞—è –ü—Ä–∏—á–∏–Ω–∞
–ü–∞—Ä—Å–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `rule=width-300`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Subito API.

### –†–µ—à–µ–Ω–∏–µ
| –î–æ | –ü–æ—Å–ª–µ |
|----|-------|
| `?rule=width-300` ‚ùå | `?rule=card-mobile-large-1x-auto` ‚úÖ |

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –í—Å–µ —ç—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—ã–ª–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:
‚úÖ card-mobile-large-1x-auto  ‚Üí 200 OK
‚úÖ card-desktop-large-1x-auto ‚Üí 200 OK
‚ùå width-300                   ‚Üí 404 Not Found
‚ùå detail                       ‚Üí 404 Not Found
‚ùå card, list-*, width-600, etc ‚Üí 404 Not Found
```

### –§–∞–π–ª, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π
üìù `src/parsers/subito_scraper.py` (—Å—Ç—Ä–æ–∫–∏ 179-193)

```python
# –ë—ã–ª–æ:
if 'sbito.it' in base_url:
    img_url = f"{base_url}?rule=width-300"

# –°—Ç–∞–ª–æ:
if 'sbito.it' in base_url and 'rule=' not in base_url:
    img_url = f"{base_url}?rule=card-mobile-large-1x-auto"
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç
```
–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:  290/300 –æ–±—ä—è–≤–ª–µ–Ω–∏–π (–Ω–æ —Å 404 –æ—à–∏–±–∫–∞–º–∏)
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 32/33 –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å —Ä–∞–±–æ—á–∏–º–∏ URL ‚úÖ
```

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞ 2: Casa.it - 400 Bad Request

### –°–∏–º–ø—Ç–æ–º—ã
- –ë—Ä–∞—É–∑–µ—Ä –≤—ã–±—Ä–∞—Å—ã–≤–∞–ª –æ—à–∏–±–∫—É: `400 Bad Request`
- URL: `https://images-1.casa.it/listing/0/08/2a/9c/723433603.jpg`

### –ö–æ—Ä–Ω–µ–≤–∞—è –ü—Ä–∏—á–∏–Ω–∞
Casa.it —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ URL. –ü–∞—Ä—Å–µ—Ä –∫–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä–æ–≤–∞–ª –±–∞–∑–æ–≤—ã–π URL `https://images-1.casa.it/` 
—Å –ø—É—Ç–µ–º, –Ω–æ **–ø—Ä–æ–ø—É—Å–∫–∞–ª —Ä–∞–∑–º–µ—Ä** (800x600, 360x265 –∏ —Ç.–¥.).

### –†–µ—à–µ–Ω–∏–µ
| –î–æ | –ü–æ—Å–ª–µ |
|----|-------|
| `https://images-1.casa.it/listing/...jpg` ‚ùå | `https://images-1.casa.it/800x600/listing/...jpg` ‚úÖ |

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –í—Å–µ —Ä–∞–∑–º–µ—Ä—ã –±—ã–ª–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:
‚úÖ https://images-1.casa.it/800x600/listing/0/08/2a/9c/723433603.jpg ‚Üí 200 OK
‚úÖ https://images-1.casa.it/360x265/listing/0/08/2a/9c/723433603.jpg ‚Üí 200 OK
‚ùå https://images-1.casa.it/listing/0/08/2a/9c/723433603.jpg          ‚Üí 400 Bad Request
```

### –§–∞–π–ª, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π
üìù `src/parsers/casa_scraper.py` (—Å—Ç—Ä–æ–∫–∏ 137-155)

```python
# –ë—ã–ª–æ:
img_url = self.image_base_url + uri

# –°—Ç–∞–ª–æ:
# Casa.it —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑–º–µ—Ä –≤ URL: /800x600/ –∏–ª–∏ /360x265/
uri = uri.lstrip('/')
img_url = self.image_base_url + '800x600/' + uri
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç
```
–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:  23 –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å 400 –æ—à–∏–±–∫–∞–º–∏
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 20/20 –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å —Ä–∞–±–æ—á–∏–º–∏ URL ‚úÖ
```

---

## üìä –ò—Ç–æ–≥–∏

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
| –ò—Å—Ç–æ—á–Ω–∏–∫ | –î–æ | –ü–æ—Å–ª–µ | –°—Ç–∞—Ç—É—Å |
|----------|-----|-------|--------|
| Subito.it | ‚ùå 404 | ‚úÖ 32/33 (97%) | FIXED |
| Casa.it | ‚ùå 400 | ‚úÖ 20/20 (100%) | FIXED |

### –ö–æ–º–º–∏—Ç—ã
```
4f0f496 - fix: –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π Subito —Å width-300 –Ω–∞ card-mobile-large-1x-auto
17bd043 - fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π Casa.it –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –≤ –ø—É—Ç—å
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î
```sql
-- Subito: –Ω–æ–≤—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ URL
SELECT COUNT(*) FROM listings 
WHERE source='subito' AND images LIKE '%card-mobile-large-1x-auto%';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 32 –æ–±—ä—è–≤–ª–µ–Ω–∏–π ‚úÖ

-- Casa.it: –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏–º–µ—é—Ç —Ä–∞–∑–º–µ—Ä –≤ URL
SELECT COUNT(*) FROM listings 
WHERE source='casa_it' AND images LIKE '%800x600%';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 20 –æ–±—ä—è–≤–ª–µ–Ω–∏–π ‚úÖ
```

---

## üîç –ö–∞–∫ –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

1. **–û—Ç–ª–∞–¥–∫–∞ Subito.it:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ù–∞—à–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `rule=card-mobile-large-1x-auto` –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö img —Ç–µ–≥–∞—Ö
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ HEAD –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –í—ã—è–≤–∏–ª–∏, —á—Ç–æ `width-300` ‚Üí 404, –∞ `card-mobile-large-1x-auto` ‚Üí 200

2. **–û—Ç–ª–∞–¥–∫–∞ Casa.it:**
   - –ê–Ω–∞–ª–∏–∑ JSON —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–±—ä—è–≤–ª–µ–Ω–∏—è
   - –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Å–µ—Ö image URL –≤ HTML
   - –ù–∞—à–ª–∏ –ø–∞—Ç–µ—Ä–Ω—ã: `/800x600/listing/...` –∏ `/360x265/listing/...`
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ HEAD –∑–∞–ø—Ä–æ—Å—ã
   - –í—ã—è–≤–∏–ª–∏, —á—Ç–æ —Ä–∞–∑–º–µ—Ä –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –≤ –ø—É—Ç–∏

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:
- ‚úÖ HEAD –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 200 OK
- ‚úÖ Content-Type: image/jpeg
- ‚úÖ Content-Length: > 0 (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ URL:
```
https://images.sbito.it/api/v1/sbt-ads-images-pro/images/d4/d4f949af-b20a-4cec-ab80-a553ea06bbde?rule=card-mobile-large-1x-auto
‚Üí Status: 200 OK ‚úÖ
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–∏ URL
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å fallback –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—Ä—É–≥–∏–µ –ø–∞—Ä—Å–µ—Ä—ã (Idealista, Immobiliare) –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–æ–±–ª–µ–º

