# üó∫Ô∏è –ù–ê–°–¢–†–û–ô–ö–ê –°–ï–†–í–ò–°–ê –ö–ê–†–¢–´

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞

| –ü–æ–ª–µ API       | –¢–∏–ø      | –û–ø–∏—Å–∞–Ω–∏–µ                                           |
| -------------- | -------- | -------------------------------------------------- |
| `id`           | string   | ID –æ–±—ä—è–≤–ª–µ–Ω–∏—è                                      |
| `source_site`  | string   | –ò—Å—Ç–æ—á–Ω–∏–∫ (casa_it, idealista, immobiliare, subito) |
| `url`          | string   | –°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª                                 |
| `title`        | string   | –ó–∞–≥–æ–ª–æ–≤–æ–∫                                          |
| `price`        | number   | –¶–µ–Ω–∞ –≤ –µ–≤—Ä–æ                                        |
| `address_text` | string   | –ê–¥—Ä–µ—Å                                              |
| `city`         | string   | –ì–æ—Ä–æ–¥                                              |
| `district`     | string   | –†–∞–π–æ–Ω                                              |
| `latitude`     | number   | –®–∏—Ä–æ—Ç–∞                                             |
| `longitude`    | number   | –î–æ–ª–≥–æ—Ç–∞                                            |
| `area_sqm`     | number   | –ü–ª–æ—â–∞–¥—å –º¬≤                                         |
| `num_rooms`    | number   | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç                                  |
| `images`       | string[] | –ú–∞—Å—Å–∏–≤ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π                             |

### 2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã

- ‚úÖ `MapPage.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ä—Ç—ã
- ‚úÖ `MapView.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã —Å Leaflet
- ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ API
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω –∏ –¥–∞–Ω–Ω—ã—Ö

### 3. –î–∞–Ω–Ω—ã–µ –≤ –ë–î

```bash
‚úÖ 40 –æ–±—ä—è–≤–ª–µ–Ω–∏–π Casa.it —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
üìç 100% –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
üó∫Ô∏è –ì–æ—Ç–æ–≤—ã –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é –Ω–∞ –∫–∞—Ä—Ç–µ
```

## üöÄ –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å Backend

```bash
cd /Users/aleksandrbaranov/Documents/Work/MY_CODE_PROJECTS/ITA_RENT_02

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
source venv/bin/activate  # –∏–ª–∏ .venv/bin/activate

# –ó–∞–ø—É—Å—Ç–∏—Ç—å FastAPI —Å–µ—Ä–≤–µ—Ä
uvicorn src.main:app --reload --port 8000
```

Backend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: `http://localhost:8000`

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å Frontend

```bash
cd /Users/aleksandrbaranov/Documents/Work/MY_CODE_PROJECTS/ITA_RENT_02/frontend

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä
npm run dev
```

Frontend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: `http://localhost:5173`

### –®–∞–≥ 3: –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: **http://localhost:5173/map**

## üìä –ß—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ

### –ú–∞—Å—à—Ç–∞–± 1: –û–±—â–∏–π –≤–∏–¥ (–≤—Å—è –†–∏–º–∞)

```
üó∫Ô∏è –ö–∞—Ä—Ç–∞ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
üìç –ú–∞—Ä–∫–µ—Ä—ã —Ä–∞–∑–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º:
   ‚Ä¢ –°–∏–Ω–∏–π (Id) - Idealista
   ‚Ä¢ –ö—Ä–∞—Å–Ω—ã–π (I) - Immobiliare
   ‚Ä¢ –°–∏–Ω–∏–π - Casa.it (–Ω–æ–≤—ã–π!)
   ‚Ä¢ –°–∏–Ω–∏–π - Subito
```

### –ú–∞—Å—à—Ç–∞–± 2: –†–∞–π–æ–Ω—ã

```
üîç –ö–ª–∞—Å—Ç–µ—Ä—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ —Ä–∞–π–æ–Ω–∞–º
üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
üí° –ö–ª–∏–∫ –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä ‚Üí –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ
```

### –ú–∞—Å—à—Ç–∞–± 3: –î–µ—Ç–∞–ª–∏

```
üìç –û—Ç–¥–µ–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
üí≠ –ö–ª–∏–∫ –Ω–∞ –º–∞—Ä–∫–µ—Ä ‚Üí popup —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
   ‚Ä¢ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   ‚Ä¢ –ù–∞–∑–≤–∞–Ω–∏–µ
   ‚Ä¢ –¶–µ–Ω–∞
   ‚Ä¢ –ü–ª–æ—â–∞–¥—å –∏ –∫–æ–º–Ω–∞—Ç—ã
   ‚Ä¢ –ê–¥—Ä–µ—Å
   ‚Ä¢ –ö–Ω–æ–ø–∫–∞ "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ"
```

## üé® –§—É–Ω–∫—Ü–∏–∏ –∫–∞—Ä—Ç—ã

### –ù–∞–≤–∏–≥–∞—Ü–∏—è

- **–ö–æ–ª–µ—Å–∏–∫–æ –º—ã—à–∏** - –∑—É–º
- **Drag** - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
- **+/- –∫–Ω–æ–ø–∫–∏** - –∑—É–º
- **Auto-fit** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –∫ –º–∞—Ä–∫–µ—Ä–∞–º

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è

–§–∏–ª—å—Ç—Ä—ã –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

```typescript
/map?city=roma&min_price=500&max_price=2000&rooms=2
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `city` - –≥–æ—Ä–æ–¥ (roma, milano, etc.)
- `min_price` / `max_price` - –¥–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω
- `min_area` / `max_area` - –¥–∏–∞–ø–∞–∑–æ–Ω –ø–ª–æ—â–∞–¥–∏
- `rooms_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç
- `property_type` - —Ç–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
- `source_site` - –∏—Å—Ç–æ—á–Ω–∏–∫ (casa_it, idealista, etc.)

### –õ–µ–≥–µ–Ω–¥–∞

```
üî¥ I - Immobiliare.it
üîµ Id - Idealista.it
üîµ C - Casa.it (–Ω–æ–≤—ã–π!)
üîµ S - Subito.it
```

## üõ†Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

```bash
python /tmp/test_api_response.py
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

```
üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –ë–î:
  id: 39
  external_id: casa_it_52353623
  source: casa_it
  ...
  latitude: 41.902631
  longitude: 12.440198
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ API

```bash
curl http://localhost:8000/api/v1/listings/?city=Roma&limit=5
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON —Å 5 –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ä—Ç—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:5173/map`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - ‚úÖ –ú–∞—Ä–∫–µ—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
   - ‚úÖ –ö–ª–∏–∫ –Ω–∞ –º–∞—Ä–∫–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç popup
   - ‚úÖ Popup —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —Ü–µ–Ω—É, –∞–¥—Ä–µ—Å
   - ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ" —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìù API Endpoints

### GET /api/v1/listings/

–ü–æ–∏—Å–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

```typescript
{
  city?: string;
  min_price?: number;
  max_price?: number;
  property_type?: string;
  min_rooms?: number;
  max_rooms?: number;
  min_area?: number;
  max_area?: number;
  source_site?: string;
  skip?: number;
  limit?: number;
}
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "success": true,
  "total_count": 40,
  "returned_count": 40,
  "listings": [
    {
      "id": "39",
      "source_site": "casa_it",
      "url": "https://www.casa.it/...",
      "title": "Trilocale in Via...",
      "price": 1450,
      "address_text": "Via Carlo Galassi Paluzzi",
      "city": "Roma",
      "district": "Gregorio VII",
      "latitude": 41.902631,
      "longitude": 12.440198,
      "area_sqm": null,
      "num_rooms": 3,
      "images": ["https://...", "https://..."],
      ...
    }
  ]
}
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–æ–∏—Å–∫–æ–º

–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞:

```typescript
// SearchResultsPage.tsx
<button onClick={() => navigate(`/map?${searchParams.toString()}`)}>
  üó∫Ô∏è –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
</button>
```

### –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `react-leaflet-cluster`:

```bash
npm install react-leaflet-cluster
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ MapView:

```typescript
import MarkerClusterGroup from 'react-leaflet-cluster';

<MarkerClusterGroup>
  {listingsWithCoords.map(listing => (
    <Marker ... />
  ))}
</MarkerClusterGroup>
```

### –†–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ –º–∞—Ä–∫–µ—Ä–æ–≤

–û–±–Ω–æ–≤–∏—Ç—å `getMarkerIcon()` –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:

```typescript
const getMarkerIcon = (source: string) => {
  const colors = {
    casa_it: "#2ecc71", // –ó–µ–ª–µ–Ω—ã–π
    idealista: "#3498db", // –°–∏–Ω–∏–π
    immobiliare: "#e74c3c", // –ö—Ä–∞—Å–Ω—ã–π
    subito: "#f39c12", // –û—Ä–∞–Ω–∂–µ–≤—ã–π
  };

  const letters = {
    casa_it: "C",
    idealista: "Id",
    immobiliare: "I",
    subito: "S",
  };

  return L.divIcon({
    html: `<div style="background: ${colors[source]}">
      ${letters[source]}
    </div>`,
  });
};
```

### –§–∏–ª—å—Ç—Ä—ã –Ω–∞ –∫–∞—Ä—Ç–µ

–î–æ–±–∞–≤–∏—Ç—å sidebar —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –ø—Ä—è–º–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–∞—Ä—Ç—ã:

```typescript
// MapPage.tsx
<div className={styles.mapContainer}>
  <MapFilters onFiltersChange={handleFiltersChange} />
  <MapView listings={filteredListings} />
</div>
```

## üêõ Troubleshooting

### –ö–∞—Ä—Ç–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–µ–ª—ã–π —ç–∫—Ä–∞–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `leaflet.css` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `.map` –∏–º–µ–µ—Ç `height: 100vh` –∏–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤—ã—Å–æ—Ç—É

```scss
.map {
  height: 100vh;
  width: 100%;
}
```

### –ú–∞—Ä–∫–µ—Ä—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞—Ä—Ç–∞ –µ—Å—Ç—å, –Ω–æ –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Å–æ–ª–∏: `console.log('Listings:', listings)`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –æ–±—ä—è–≤–ª–µ–Ω–∏–π –µ—Å—Ç—å `latitude` –∏ `longitude`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä: `listingsWithCoords.length`

### Popup –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–ª–∏–∫ –Ω–∞ –º–∞—Ä–∫–µ—Ä –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `Popup` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `Marker`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è popup –¥–æ—Å—Ç—É–ø–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CSS –¥–ª—è `.customPopup`

## üìö –†–µ—Å—É—Ä—Å—ã

- [Leaflet Documentation](https://leafletjs.com/reference.html)
- [React Leaflet](https://react-leaflet.js.org/)
- [OpenStreetMap Tiles](https://wiki.openstreetmap.org/wiki/Tiles)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0
