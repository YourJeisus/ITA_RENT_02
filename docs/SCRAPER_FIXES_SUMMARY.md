# üîß –°–≤–æ–¥–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å–∫—Ä–∞–ø–µ—Ä–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. ‚ùå –î—É–±–ª–∏–∫–∞—Ç—ã URL –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** `UniqueViolation: duplicate key value violates unique constraint "listings_url_key"`

**–†–µ—à–µ–Ω–∏–µ:**

- ‚úÖ –£–¥–∞–ª–µ–Ω `unique=True` constraint —Å –ø–æ–ª—è `url` –≤ –º–æ–¥–µ–ª–∏ `Listing`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `3bbdf8a6923d_remove_unique_constraint_from_listings_.py`
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ `save_listings_to_db()`

### 2. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –±—ã–ª–æ –≤–∏–¥–Ω–æ —Å–∫–æ–ª—å–∫–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –≤ `save_listings_to_db()`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ –∫–∞–∂–¥–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–æ–≤—ã—Ö/–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö/–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `run_all_scraping.py`

### 3. ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –±—ã–ª–æ –≤–∏–¥–Ω–æ –ø–æ—á–µ–º—É –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å `sent_count` –≤ `process_user_notifications()`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ worker —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º

## –ù–æ–≤—ã–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1. üîç `scripts/debug_system_status.py`

–ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:

- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 2. üß™ `test_single_scraper.py`

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–∫—Ä–∞–ø–µ—Ä–æ–≤:

- Idealista, Immobiliare, Subito
- –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å–∫—Ä–∞–ø–∏–Ω–≥–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É

### 3. üìä –£–ª—É—á—à–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ `get_database_statistics()`

–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î:

- –û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ 24 —á–∞—Å–∞ –∏ –Ω–µ–¥–µ–ª—é

## –£–ª—É—á—à–µ–Ω–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –°–∫—Ä–∞–ø–∏–Ω–≥

```
üíæ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:
   üìä –û–±—â–∞—è: 12 –Ω–æ–≤—ã—Ö, 8 –æ–±–Ω–æ–≤–ª–µ–Ω–æ, 6 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, 2 –æ—à–∏–±–∫–∏
   üìå IDEALISTA: 5 –Ω–æ–≤—ã—Ö, 3 –æ–±–Ω–æ–≤–ª–µ–Ω–æ, 2 –ø—Ä–æ–ø—É—â–µ–Ω–æ, 0 –æ—à–∏–±–æ–∫ –∏–∑ 10 –≤—Å–µ–≥–æ
   üìå SUBITO: 4 –Ω–æ–≤—ã—Ö, 2 –æ–±–Ω–æ–≤–ª–µ–Ω–æ, 3 –ø—Ä–æ–ø—É—â–µ–Ω–æ, 1 –æ—à–∏–±–∫–∞ –∏–∑ 10 –≤—Å–µ–≥–æ
   üìå IMMOBILIARE: 3 –Ω–æ–≤—ã—Ö, 3 –æ–±–Ω–æ–≤–ª–µ–Ω–æ, 1 –ø—Ä–æ–ø—É—â–µ–Ω–æ, 1 –æ—à–∏–±–∫–∞ –∏–∑ 8 –≤—Å–µ–≥–æ
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```
üêõ [DEBUG] –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ 123 '–ö–≤–∞—Ä—Ç–∏—Ä–∞ –≤ –†–∏–º–µ' –Ω–∞–π–¥–µ–Ω–æ 5 –Ω–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
üêõ [DEBUG]   - Appartamento in Via del Corso... (ID: 456, –∏—Å—Ç–æ—á–Ω–∏–∫: idealista)
üêõ [DEBUG]   - Casa in Trastevere... (ID: 789, –∏—Å—Ç–æ—á–Ω–∏–∫: subito)
üêõ [DEBUG] –ö –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º: {'idealista': 3, 'subito': 2}
```

## –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:**

```bash
alembic upgrade head
```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É:**

```bash
python scripts/debug_system_status.py
```

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∞–ø–µ—Ä—ã:**

```bash
python test_single_scraper.py all
```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**

```bash
export DEBUG_NOTIFICATIONS=true
python scripts/run_notification_worker.py
```

## –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ù–µ—Ç –±–æ–ª—å—à–µ –æ—à–∏–±–æ–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ URL** - —Å–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ URL –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
2. **–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –≤–∏–¥–Ω–æ —Å–∫–æ–ª—å–∫–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
3. **–õ—É—á—à–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
4. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã** - –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

## –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```bash
export DEBUG_NOTIFICATIONS=true
```

–í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ:

- –û—Ç–∫–ª—é—á–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –†–∞–∑—Ä–µ—à–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –í–∫–ª—é—á–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
