# üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WhatsApp —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è ITA_RENT_BOT

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É WhatsApp —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º.

## üéØ –û–±–∑–æ—Ä

WhatsApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏—è—Ö –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ WhatsApp –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ Telegram. –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

- ‚úÖ –¢–µ–∫—Å—Ç–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –¥–µ—Ç–∞–ª—è–º–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤
- ‚úÖ –û—Ç–¥–µ–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WhatsApp Business API

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ WhatsApp Business API

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å WhatsApp —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ **WhatsApp Business API**. –ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

#### –í–∞—Ä–∏–∞–Ω—Ç 1: Meta Business (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ [Meta Business](https://business.facebook.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ WhatsApp Business –∞–∫–∫–∞—É–Ω—Ç
3. –ü–æ–ª—É—á–∏—Ç–µ API —Ç–æ–∫–µ–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –°—Ç–æ—Ä–æ–Ω–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

- **Twilio** - [https://www.twilio.com/whatsapp](https://www.twilio.com/whatsapp)
- **MessageBird** - [https://messagebird.com/whatsapp](https://messagebird.com/whatsapp)
- **360Dialog** - [https://www.360dialog.com/](https://www.360dialog.com/)
- **ChatAPI** - [https://chat-api.com/](https://chat-api.com/)

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –≤–∞—à `.env` —Ñ–∞–π–ª:

```bash
# WhatsApp API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
WHATSAPP_ENABLED=true
WHATSAPP_API_URL=https://your-whatsapp-provider.com/v1
WHATSAPP_API_TOKEN=your_whatsapp_api_token
WHATSAPP_PHONE_NUMBER_ID=your_phone_number_id
WHATSAPP_BUSINESS_ACCOUNT_ID=your_business_account_id
WHATSAPP_WEBHOOK_VERIFY_TOKEN=your_webhook_verify_token

# –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
WHATSAPP_NOTIFICATION_INTERVAL_SECONDS=1800  # 30 –º–∏–Ω—É—Ç
```

### 3. –ü—Ä–∏–º–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

#### Twilio –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
WHATSAPP_API_URL=https://api.twilio.com/2010-04-01/Accounts/YOUR_ACCOUNT_SID/Messages.json
WHATSAPP_API_TOKEN=your_twilio_auth_token
WHATSAPP_PHONE_NUMBER_ID=whatsapp:+14155238886
```

#### 360Dialog –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
WHATSAPP_API_URL=https://waba.360dialog.io
WHATSAPP_API_TOKEN=your_360dialog_token
WHATSAPP_PHONE_NUMBER_ID=your_phone_number_id
```

## üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

### 1. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è WhatsApp –ø–æ–ª–µ–π
alembic upgrade head
```

### 2. –ó–∞–ø—É—Å–∫ WhatsApp worker

```bash
# –ó–∞–ø—É—Å–∫ –≤ production
python run_whatsapp_worker.py

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
DEBUG_NOTIFICATIONS=true python run_whatsapp_worker.py
```

### 3. –ó–∞–ø—É—Å–∫ –≤ Docker

–û–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à `docker-compose.yml`:

```yaml
services:
  # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã ...

  whatsapp-worker:
    build: .
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - WHATSAPP_ENABLED=${WHATSAPP_ENABLED}
      - WHATSAPP_API_URL=${WHATSAPP_API_URL}
      - WHATSAPP_API_TOKEN=${WHATSAPP_API_TOKEN}
      - WHATSAPP_PHONE_NUMBER_ID=${WHATSAPP_PHONE_NUMBER_ID}
    command: python run_whatsapp_worker.py
    depends_on:
      - api
    restart: unless-stopped
```

## üìã API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ WhatsApp

```http
GET /api/v1/whatsapp/status
Authorization: Bearer your_jwt_token
```

### –ü—Ä–∏–≤—è–∑–∫–∞ WhatsApp –Ω–æ–º–µ—Ä–∞

```http
POST /api/v1/whatsapp/link
Authorization: Bearer your_jwt_token
Content-Type: application/json

{
  "phone_number": "+393401234567",
  "instance_id": "optional_instance_id"
}
```

### –û—Ç–≤—è–∑–∫–∞ WhatsApp –Ω–æ–º–µ—Ä–∞

```http
DELETE /api/v1/whatsapp/unlink
Authorization: Bearer your_jwt_token
```

### –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```http
POST /api/v1/whatsapp/toggle
Authorization: Bearer your_jwt_token
Content-Type: application/json

{
  "enabled": true
}
```

### –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

```http
POST /api/v1/whatsapp/test
Authorization: Bearer your_jwt_token
Content-Type: application/json

{
  "phone_number": "+393401234567"
}
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ WhatsApp

```http
GET /api/v1/whatsapp/settings
```

## üé® –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ü—Ä–∏–º–µ—Ä WhatsApp —Å–æ–æ–±—â–µ–Ω–∏—è

```
üè† *–ù–æ–≤—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è!*

üìç –§–∏–ª—å—Ç—Ä: _–ö–≤–∞—Ä—Ç–∏—Ä–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –†–∏–º–∞_
üìä –ù–∞–π–¥–µ–Ω–æ: 3 –æ–±—ä—è–≤–ª–µ–Ω–∏—è

*1. –ü—Ä–µ–∫—Ä–∞—Å–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–º —Ü–µ–Ω—Ç—Ä–µ*
üí∞ 1800‚Ç¨/–º–µ—Å ‚Ä¢ üö™ 3 –∫–æ–º–Ω. ‚Ä¢ üìê 85 –º¬≤
üìç Via del Corso, 123, Roma
üîó https://www.idealista.it/...
üì± –ò—Å—Ç–æ—á–Ω–∏–∫: IDEALISTA

*2. –£—é—Ç–Ω–∞—è —Å—Ç—É–¥–∏—è —Ä—è–¥–æ–º —Å –ö–æ–ª–∏–∑–µ–µ–º*
üí∞ 1200‚Ç¨/–º–µ—Å ‚Ä¢ üö™ 1 –∫–æ–º–Ω. ‚Ä¢ üìê 45 –º¬≤
üìç Via dei Fori Imperiali, Roma
üîó https://www.immobiliare.it/...
üì± –ò—Å—Ç–æ—á–Ω–∏–∫: IMMOBILIARE

*3. –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –¥–≤—É—à–∫–∞ –≤ –¢—Ä–∞—Å—Ç–µ–≤–µ—Ä–µ*
üí∞ 1600‚Ç¨/–º–µ—Å ‚Ä¢ üö™ 2 –∫–æ–º–Ω. ‚Ä¢ üìê 70 –º¬≤
üìç Trastevere, Roma
üîó https://www.idealista.it/...
üì± –ò—Å—Ç–æ—á–Ω–∏–∫: IDEALISTA

üí° _–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ_
```

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É Telegram –∏ WhatsApp

| –§—É–Ω–∫—Ü–∏—è                          | Telegram       | WhatsApp      |
| -------------------------------- | -------------- | ------------- |
| –ú–∞–∫—Å–∏–º—É–º –æ–±—ä—è–≤–ª–µ–Ω–∏–π –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ | 5              | 3             |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Markdown               | –ü–æ–ª–Ω–∞—è         | –ë–∞–∑–æ–≤–∞—è       |
| –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è                      | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è | –ü–æ–∫–∞ –Ω–µ—Ç      |
| –ö–Ω–æ–ø–∫–∏/–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞                | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è | –ü–æ–∫–∞ –Ω–µ—Ç      |
| –î–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è                  | 4096 —Å–∏–º–≤–æ–ª–æ–≤  | 4096 —Å–∏–º–≤–æ–ª–æ–≤ |

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   Notification Service                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  process_user_notifications()                                   ‚îÇ
‚îÇ           ‚îÇ                                                     ‚îÇ
‚îÇ           ‚îú‚îÄ‚îÄ‚îÄ send_notification_for_filter()                   ‚îÇ
‚îÇ           ‚îÇ            ‚îÇ                                        ‚îÇ
‚îÇ           ‚îÇ            ‚îú‚îÄ‚îÄ‚îÄ Telegram: send_listing_notification ‚îÇ
‚îÇ           ‚îÇ            ‚îî‚îÄ‚îÄ‚îÄ WhatsApp: send_whatsapp_listing     ‚îÇ
‚îÇ           ‚îÇ                                                     ‚îÇ
‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏                       ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–æ–≤**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ Telegram –∏/–∏–ª–∏ WhatsApp
3. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤ –æ–±–∞ –∫–∞–Ω–∞–ª–∞ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏**: –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω—ã–º –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–∞–Ω–∞–ª —Å—Ä–∞–±–æ—Ç–∞–ª

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ WhatsApp worker

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f logs/whatsapp_worker.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
grep "ERROR" logs/whatsapp_worker.log

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
grep "WhatsApp.*–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ" logs/whatsapp_worker.log
```

### –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏

```bash
# –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
export DEBUG_NOTIFICATIONS=true
export WHATSAPP_NOTIFICATION_INTERVAL_SECONDS=60

# –ó–∞–ø—É—Å—Ç–∏—Ç—å worker –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
python run_whatsapp_worker.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ API

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WhatsApp
curl -X GET "http://localhost:8000/api/v1/whatsapp/settings"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X GET "http://localhost:8000/api/v1/whatsapp/status" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. "WhatsApp —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã"

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo $WHATSAPP_ENABLED

# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å true
export WHATSAPP_ENABLED=true
```

#### 2. "–ù–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WhatsApp API –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
echo $WHATSAPP_API_URL
echo $WHATSAPP_API_TOKEN
echo $WHATSAPP_PHONE_NUMBER_ID
```

#### 3. "Cannot add a NOT NULL column with default value NULL"

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
sqlite3 ita_rent.db "ALTER TABLE users ADD COLUMN whatsapp_enabled BOOLEAN NOT NULL DEFAULT 0;"
alembic stamp head
```

#### 4. –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å API —Ç–æ–∫–µ–Ω–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ WhatsApp Business –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ WhatsApp API
curl -X POST "${WHATSAPP_API_URL}/${WHATSAPP_PHONE_NUMBER_ID}/messages" \
  -H "Authorization: Bearer ${WHATSAPP_API_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "messaging_product": "whatsapp",
    "to": "393401234567",
    "type": "text",
    "text": {"body": "–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"}
  }'
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ —Å–µ–∫—Ä–µ—Ç–µ**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ API —Ç–æ–∫–µ–Ω—ã –≤ Git
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ IP –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è webhook'–æ–≤
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –Ω–µ–æ–±—ã—á–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å API

### –†–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
export WHATSAPP_API_TOKEN=new_token
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ worker
```

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### Production —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—á–µ—Ä–µ–¥–∏**: –î–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ Redis/RabbitMQ
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
3. **–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ fallback –Ω–∞ –¥—Ä—É–≥–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
4. **–õ–∏–º–∏—Ç—ã**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ª–∏–º–∏—Ç—ã API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Å
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø–∞–º

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Railway.app

–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Railway:

```bash
WHATSAPP_ENABLED=true
WHATSAPP_API_URL=your_api_url
WHATSAPP_API_TOKEN=your_token
WHATSAPP_PHONE_NUMBER_ID=your_phone_id
```

### Vercel + Backend

WhatsApp worker –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ backend —Å–µ—Ä–≤–µ—Ä–µ (Railway, DigitalOcean –∏ —Ç.–¥.), —Ç–∞–∫ –∫–∞–∫ Vercel –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã.

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ worker'–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ API
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏ —Å–æ–∑–¥–∞–π—Ç–µ issue —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã –∏ –ª–æ–≥–∞–º–∏.
